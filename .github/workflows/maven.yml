name: Java CI with Maven

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # Step 1: Checkout the repository
    - name: Checkout code
      uses: actions/checkout@v3

    # Step 2: Set up JDK 21 (as per your Maven settings)
    - name: Set up JDK 21
      uses: actions/setup-java@v3
      with:
        java-version: '21'
        distribution: 'temurin' # You can choose another JDK provider like Zulu or AdoptOpenJDK
        cache: maven

    # Step 3: Install dependencies and run tests
    - name: Build with Maven
      run: mvn clean install --batch-mode

    # Step 4: Run OWASP Dependency-Check for vulnerability scanning
    - name: OWASP Dependency-Check
      run: |
        mvn org.owasp:dependency-check-maven:check
      continue-on-error: true # This ensures the build continues even if vulnerabilities are found

    # Step 5: Upload TestNG and OWASP reports (Optional)
    - name: Archive test results
      uses: actions/upload-artifact@v3
      with:
        name: test-results
        path: target/surefire-reports

    - name: Archive OWASP Dependency-Check report
      uses: actions/upload-artifact@v3
      with:
        name: dependency-check-report
        path: target/dependency-check-report.html

#
#  name: CI
#
#  on: [ push ]
#
#  jobs:
#    build:
#      runs-on: ubuntu-latest
#      steps:
#        - uses: actions/checkout@v2
#        - name: Set up JDK 11
#          uses: actions/setup-java@v1
#          with:
#            java-version: '11'
#        - name: Build with Maven
#          run: mvn clean install
#        - name: Run Tests
#          run: mvn test